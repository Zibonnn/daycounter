!function(){var e,t,n,s,a=document.getElementById("counters"),i=document.getElementById("no-counters"),c=document.getElementById("add-counter-btn"),o=document.getElementById("add-counter"),d=document.getElementById("close-modal"),l=document.getElementById("modal-submit"),r=document.getElementById("event-name"),u=document.getElementById("event-date"),m=document.getElementById("event-recurring"),v=document.getElementById("event-name-error"),g=document.getElementById("event-date-error"),y=document.getElementById("delete-counter"),f=document.getElementById("delete-cancel"),E=document.getElementById("delete-confirm"),L=document.getElementById("settings-toggle"),p=document.getElementById("settings"),B=document.getElementById("setting-size-list"),I=document.getElementById("setting-scheme-list"),h=document.getElementById("setting-visible-list"),b=document.getElementById("settings-save"),C=new Pikaday({field:document.getElementById("event-date"),format:"YYYY-MM-D"}),D=(Sortable.create(a,{animation:150,onEnd:function(e){M()}}),function(){r.value="",u.value=""}),N=function(){v.classList.remove("active"),g.classList.remove("active")},M=function(){var t=document.getElementsByClassName("counter");if(e={},t.length>0){for(var n=0;n<t.length;n++)t[n].id="counter-"+(n+1),e[n+1]={event:t[n].getElementsByClassName("event-name")[0].innerHTML,original:t[n].dataset.original,recurring:t[n].dataset.recurring};"active"===i.className&&(i.className="")}else i.className="active";H()},T=function(e,t,n,s,i){var c=document.createElement("li");return c.dataset.recurring=i,c.dataset.original=s,c.classList.add("counter"),cDate=moment(s).format("ddd, ll"),c.innerHTML='<a class="counter-delete transition" href="#"><i class="fa fa-times" aria-hidden="true"></i></a><h3 class="event-name">'+e+'</h3><span class="event-days">'+t+'</span><p class="event-type">'+n+'</p><span class="event-date">'+cDate+'</span><a class="counter-edit transition" href="#">Edit Counter</a>',a.appendChild(c),c},S=function(e){if(!/^\d{4}\-\d{2}\-\d{1,2}$/.test(e))return!1;var t=e.split("-"),n=parseInt(t[0]),s=parseInt(t[1]),a=parseInt(t[2]);if(n<1e3||n>3e3||s<=0||s>12)return!1;var i=[31,28,31,30,31,30,31,31,30,31,30,31];return(n%400===0||n%100!==0&&n%4===0)&&(i[1]=29),a>0&&a<=i[s-1]},O=function(e){var t=864e5,n=new Date;n.setHours(0,0,0,0),currentISO=n.toISOString();var s=new Date(e).toISOString(),a=new Date(currentISO),i=new Date(s),c={days:null,type:null};return i>a?(c.days=Math.round((i.getTime()-a.getTime())/t),c.type="Days Until"):(c.days=Math.round((a.getTime()-i.getTime())/t),c.type="Days Since"),0===c.days&&(c.days="Today",c.type="<br />"),c},H=function(){chrome.storage.sync.remove("counters",function(){chrome.storage.sync.set({counters:e},function(){console.log("Counters updated.")})})},w=function(){chrome.storage.sync.get("counters",function(e){for(var t in e.counters)if(e.counters.hasOwnProperty(t)){var n=e.counters[t];n.hasOwnProperty("recurring")||(n.recurring="none");var s=O(n.original);T(n.event,s.days,s.type,n.original,n.recurring)}M(),k()})},k=function(){for(var e=document.getElementsByClassName("counter-edit"),t=document.getElementsByClassName("counter-delete"),n=0;n<e.length;n++)V(e[n]);for(var s=0;s<t.length;s++)j(t[s])},V=function(e){e.addEventListener("click",function(e){e.preventDefault(),n=this.parentNode,t=!0,C.setMoment(moment(n.dataset.original)),document.getElementById("modal-header-title").innerHTML="Edit Day Counter",document.getElementById("modal-submit").value="Save Day Counter",document.getElementById("event-name").value=n.getElementsByClassName("event-name")[0].innerHTML,document.getElementById("event-date").value=n.dataset.original,document.getElementById("event-recurring").value=n.dataset.recurring,o.classList.add("active")})},j=function(e){e.addEventListener("click",function(e){var t=this.parentNode;s=parseInt(t.id.split("-")[1]),y.classList.add("active")})},x=function(e){var t=document.getElementsByClassName("counter");if("undefined"!=typeof e.counterVisibility){for(var n=0;n<t.length;n++)t[n].classList.remove("disabled");if("future"===e.counterVisibility)for(var s=0;s<t.length;s++)t[s].getElementsByClassName("event-type")[0].innerHTML.indexOf("Since")!==-1&&t[s].classList.add("disabled");if("past"===e.counterVisibility)for(var a=0;a<t.length;a++)t[a].getElementsByClassName("event-type")[0].innerHTML.indexOf("Until")!==-1&&t[a].classList.add("disabled")}},Y=function(){chrome.storage.sync.get("settings",function(e){"undefined"!=typeof e.settings&&(B.value=e.settings.counterSize,I.value=e.settings.counterScheme,"undefined"!=typeof e.settings.counterVisibility&&(h.value=e.settings.counterVisibility),document.documentElement.className=I.value,a.className=B.value,window.setTimeout(function(){document.documentElement.style.transition="0.5s ease all",document.body.style.transition="0.5s ease all"},500),x(e.settings))})},z=function(){chrome.storage.sync.remove("settings",function(){chrome.storage.sync.set({settings:settingsObj},function(){console.log("Settings updated."),Y()})})},P=function(){w(),Y(),c.addEventListener("click",function(e){e.preventDefault(),console.log(e),C.gotoDate(new Date),o.classList.add("active"),document.getElementById("modal-header-title").innerHTML="Add a New Day Counter",document.getElementById("modal-submit").value="Add Day Counter",document.body.classList.add("active")}),d.addEventListener("click",function(e){e.preventDefault(),o.classList.remove("active"),D(),N(),document.body.classList.remove("active")}),l.addEventListener("click",function(){var e=r.value,s=u.value,a=m.value,i=!1;if(""===e||null===e?(v.classList.add("active"),i=!0):v.classList.remove("active"),""!==s&&null!==s&&S(s)?g.classList.remove("active"):(g.classList.add("active"),i=!0),!i){var c=O(s);if(t)n.getElementsByClassName("event-name")[0].innerHTML=e,n.getElementsByClassName("event-days")[0].innerHTML=c.days,n.getElementsByClassName("event-type")[0].innerHTML=c.type,n.getElementsByClassName("event-date")[0].innerHTML=moment(s).format("ddd, ll"),n.dataset.original=s,n.dataset.recurring=a,n=null,t=!1;else{var d=T(e,c.days,c.type,s,a);V(d.getElementsByClassName("counter-edit")[0]),j(d.getElementsByClassName("counter-delete")[0])}o.classList.remove("active"),document.body.classList.remove("active"),D(),N(),M()}}),E.addEventListener("click",function(e){e.preventDefault(),document.getElementById("counter-"+s).remove(),M(),y.classList.remove("active")}),f.addEventListener("click",function(e){e.preventDefault(),s=null,y.classList.remove("active")}),L.addEventListener("click",function(){this.classList.contains("active")?(this.classList.remove("active"),p.classList.remove("active")):(this.classList.add("active"),p.classList.add("active"))}),b.addEventListener("click",function(e){e.preventDefault(),settingsObj={},settingsObj.counterSize=B.options[B.selectedIndex].value,settingsObj.counterScheme=I.options[I.selectedIndex].value,settingsObj.counterVisibility=h.options[h.selectedIndex].value,z()})};document.addEventListener("DOMContentLoaded",P)}();