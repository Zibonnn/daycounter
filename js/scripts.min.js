!function(){var e,t,n,i,a,s,o,c,d=document.getElementById("counters"),r=document.getElementById("no-counters"),l=document.getElementById("add-counter-btn"),u=document.getElementById("add-counter"),m=document.getElementById("close-modal"),v=document.getElementById("modal-submit"),g=document.getElementById("event-name"),f=document.getElementById("event-date"),y=document.getElementById("event-name-error"),h=document.getElementById("event-date-error"),p=document.getElementById("counter-deleted"),L=document.getElementById("undo-delete"),E=document.getElementById("settings-toggle"),I=document.getElementById("settings"),B=document.getElementById("setting-size-list"),b=document.getElementById("setting-scheme-list"),T=document.getElementById("setting-visible-list"),D=document.getElementById("settings-save"),M=!1;picker=new Pikaday({field:document.getElementById("event-date"),format:"YYYY-MM-D"});var N=function(e,t){e.value="",t.value=""},w=function(e,t){e.classList.remove("active"),t.classList.remove("active")},C=function(e){if(!/^\d{4}\-\d{2}\-\d{1,2}$/.test(e))return!1;var t=e.split("-"),n=parseInt(t[0]),i=parseInt(t[1]),a=parseInt(t[2]);if(n<1e3||n>3e3||i<=0||i>12)return!1;var s=[31,28,31,30,31,30,31,31,30,31,30,31];return(n%400===0||n%100!==0&&n%4===0)&&(s[1]=29),a>0&&a<=s[i-1]},S=function(e){var t=864e5,n=new Date;n.setHours(0,0,0,0),currentISO=n.toISOString();var i=new Date(e).toISOString(),a=new Date(currentISO),s=new Date(i),o={days:null,type:null,original:null};return s>a?(o.days=Math.round((s.getTime()-a.getTime())/t),o.type="Days Until"):(o.days=Math.round((a.getTime()-s.getTime())/t),o.type="Days Since"),0===o.days&&(o.days="Today",o.type="<br />"),o.original=e,o},H=function(){var e=document.getElementsByClassName("counter");if(o={},e.length>0){for(var t=0;t<e.length;t++)e[t].id="counter-"+(t+1),o["counter"+(t+1)]={event:e[t].children[2].innerHTML,original:e[t].children[7].innerHTML};"active"===r.className&&(r.className="")}else r.className="active"},k=function(e,t,n,i){var a=document.createElement("li");return a.classList.add("counter"),cDate=moment(i).format("ddd, ll"),a.innerHTML='<div class="counter-move"><a class="counter-mover" data-direction="back" href="#"><i class="fa fa-chevron-left" aria-hidden="true"></i></a><a class="counter-mover" data-direction="forward" href="#"><i class="fa fa-chevron-right" aria-hidden="true"></i></a></div><a class="counter-delete transition" href="#"><i class="fa fa-times" aria-hidden="true"></i></a><h3>'+e+'</h3><span class="event-days">'+t+"</span><p>"+n+'</p><span class="event-original">'+cDate+'</span><a class="counter-edit transition" href="#">Edit Counter</a><span class="event-original-hidden">'+i+"</span>",d.appendChild(a),a},x=function(){chrome.storage.sync.remove("counters",function(){chrome.storage.sync.set({counters:o},function(){console.log("Counters updated.")})})},O=function(){chrome.storage.sync.get("counters",function(e){for(var t in e.counters)if(e.counters.hasOwnProperty(t)){var n=e.counters[t],i=S(n.original);k(n.event,i.days,i.type,n.original)}H(),V()})},V=function(){e=document.getElementsByClassName("counter-edit"),t=document.getElementsByClassName("counter-delete"),moveCounters=document.getElementsByClassName("counter-mover");for(var n=0;n<e.length;n++)Y(e[n]);for(var i=0;i<t.length;i++)z(t[i]);for(var a=0;a<moveCounters.length;a++)A(moveCounters[a])},Y=function(e){e.addEventListener("click",function(e){e.preventDefault(),s=this.parentNode,M=!0,picker.setMoment(moment(s.children[7].innerHTML)),document.getElementById("modal-header-title").innerHTML="Edit Day Counter",document.getElementById("modal-submit").value="Save Day Counter",document.getElementById("event-name").value=s.children[2].innerHTML,document.getElementById("event-date").value=s.children[7].innerHTML,u.classList.add("active")})},z=function(e){e.addEventListener("click",function(e){var t=this.parentNode;i=parseInt(t.id.split("-")[1]),n=t.parentNode.removeChild(t),p.classList.add("active"),window.clearTimeout(a),a=window.setTimeout(function(){p.classList.remove("active"),H(),x()},5e3)})},A=function(e){e.addEventListener("click",function(e){var t=this.dataset.direction,n=parseInt(this.parentNode.parentNode.id.split("-")[1]);U(n,t)})},P=function(e){var t=document.getElementsByClassName("counter");if("undefined"!=typeof e.counterVisibility){for(var n=0;n<t.length;n++)t[n].classList.remove("disabled");if("future"===e.counterVisibility)for(var i=0;i<t.length;i++)t[i].children[4].innerHTML.indexOf("Until")===-1&&t[i].classList.add("disabled");if("past"===e.counterVisibility)for(var a=0;a<t.length;a++)t[a].children[4].innerHTML.indexOf("Since")===-1&&t[a].classList.add("disabled")}},U=function(e,t){var n=document.getElementById("counter-"+(e+1)),i=document.getElementById("counter-"+(e-1)),a=document.getElementById("counter-"+e);null===i&&"back"===t||null===n&&"forward"===t||("forward"===t?n.parentNode.insertBefore(a,n.nextSibling):i.parentNode.insertBefore(a,i),H(),x())},$=function(){chrome.storage.sync.get("settings",function(e){"undefined"!=typeof e.settings&&(B.value=e.settings.counterSize,b.value=e.settings.counterScheme,"undefined"!=typeof e.settings.counterVisibility&&(T.value=e.settings.counterVisibility),document.documentElement.className=b.value,d.className=B.value,window.setTimeout(function(){document.documentElement.style.transition="0.5s ease all",document.body.style.transition="0.5s ease all"},500),P(e.settings))})},j=function(){chrome.storage.sync.remove("settings",function(){chrome.storage.sync.set({settings:c},function(){console.log("Settings updated."),$()})})},q=function(){O(),$(),l.addEventListener("click",function(e){picker.gotoDate(new Date),e.preventDefault(),u.classList.add("active"),document.getElementById("modal-header-title").innerHTML="Add a New Day Counter",document.getElementById("modal-submit").value="Add Day Counter",document.body.classList.add("active")}),m.addEventListener("click",function(e){e.preventDefault(),u.classList.remove("active"),N(g,f),w(y,h),document.body.classList.remove("active")}),v.addEventListener("click",function(){var e=g.value,t=f.value,n=!1;if(""===e||null===e?(y.classList.add("active"),n=!0):y.classList.remove("active"),""!==t&&null!==t&&C(t)?h.classList.remove("active"):(h.classList.add("active"),n=!0),!n){var i=S(t);if(M)s.children[2].innerHTML=e,s.children[3].innerHTML=i.days,s.children[4].innerHTML=i.type,s.children[5].innerHTML=moment(i.original).format("ddd, ll"),s.children[7].innerHTML=i.original,s=null,M=!1;else{var a=k(e,i.days,i.type,i.original);Y(a.children[6]),z(a.children[1]),A(a.children[0].children[0]),A(a.children[0].children[1])}H(),x(),u.classList.remove("active"),document.body.classList.remove("active"),N(g,f),w(y,h)}}),L.addEventListener("click",function(e){if(e.preventDefault(),null!==n&&i>0){if(1==i||0===document.getElementsByClassName("counter").length)d.prepend(n);else{var t=document.getElementById("counter-"+(i-1));t.nextSibling?t.parentNode.insertBefore(n,t.nextSibling):d.appendChild(n)}p.classList.remove("active"),n=null,i=null,window.clearTimeout(a),H(),x()}}),E.addEventListener("click",function(){this.classList.contains("active")?(this.classList.remove("active"),I.classList.remove("active")):(this.classList.add("active"),I.classList.add("active"))}),D.addEventListener("click",function(e){e.preventDefault(),c={},c.counterSize=B.options[B.selectedIndex].value,c.counterScheme=b.options[b.selectedIndex].value,c.counterVisibility=T.options[T.selectedIndex].value,j()})};document.addEventListener("DOMContentLoaded",function(){q()})}();