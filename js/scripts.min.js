!function(){var e,t,n,a,s,i=document.getElementById("counters"),o=document.getElementById("no-counters"),d=document.getElementById("add-counter-btn"),r=document.getElementById("add-counter"),l=document.getElementById("close-modal"),c=document.getElementById("modal-submit"),m=document.getElementById("event-name"),u=document.getElementById("event-date"),v=document.getElementById("event-recurring"),g=document.getElementById("event-name-error"),y=document.getElementById("event-date-error"),f=document.getElementById("delete-counter"),E=document.getElementById("delete-cancel"),L=document.getElementById("delete-confirm"),B=document.getElementById("settings-toggle"),p=document.getElementById("settings"),I=document.getElementById("setting-size-list"),h=document.getElementById("setting-scheme-list"),Y=document.getElementById("setting-visible-list"),M=document.getElementById("setting-range-list"),D=document.getElementById("setting-fader-list"),b=document.getElementById("settings-save"),C=new Pikaday({field:document.getElementById("event-date"),format:"YYYY-MM-D"}),N=(Sortable.create(i,{animation:150,onEnd:function(e){w()}}),function(){m.value="",u.value=""}),T=function(){g.classList.remove("active"),y.classList.remove("active")},w=function(){var t=document.getElementsByClassName("counter");if(e={},t.length>0){for(var n=0;n<t.length;n++)t[n].id="counter-"+(n+1),e[n+1]={event:t[n].getElementsByClassName("event-name")[0].innerHTML,original:t[n].dataset.original,recurring:t[n].dataset.recurring};"active"===o.className&&(o.className="")}else o.className="active";H()},O=function(e,t,n,a,s){var o=document.createElement("li");return o.dataset.recurring=s,o.dataset.original=a,o.classList.add("counter"),cDate=moment(a).format("ddd, ll"),o.innerHTML='<a class="counter-delete transition" href="#"><i class="fa fa-times" aria-hidden="true"></i></a><h3 class="event-name">'+e+'</h3><span class="event-days">'+t+'</span><p class="event-type">'+n+'</p><span class="event-date">'+cDate+'</span><a class="counter-edit transition" href="#">Edit Counter</a>',i.appendChild(o),o},k=function(e){if(!/^\d{4}\-\d{2}\-\d{1,2}$/.test(e))return!1;var t=e.split("-"),n=parseInt(t[0]),a=parseInt(t[1]),s=parseInt(t[2]);if(n<1e3||n>3e3||a<=0||a>12)return!1;var i=[31,28,31,30,31,30,31,31,30,31,30,31];return(n%400==0||n%100!=0&&n%4==0)&&(i[1]=29),s>0&&s<=i[a-1]},S=function(e){var t=new Date;t.setHours(0,0,0,0),currentISO=t.toISOString();var n=new Date(e).toISOString(),a=new Date(currentISO),s=new Date(n),i={days:null,type:null};return s>a?(i.days=Math.round((s.getTime()-a.getTime())/864e5),i.type="Days Until"):(i.days=Math.round((a.getTime()-s.getTime())/864e5),i.type="Days Since"),0===i.days&&(i.days="Today",i.type="<br />"),i},H=function(){chrome.storage.sync.remove("counters",function(){chrome.storage.sync.set({counters:e},function(){console.log("Counters updated.")})})},j=function(){chrome.storage.sync.get("counters",function(e){for(var t in e.counters)if(e.counters.hasOwnProperty(t)){var n=e.counters[t],a={days:null,type:null,original:null};if(n.hasOwnProperty("recurring")||(n.recurring="none"),"none"!==n.recurring&&moment(n.original).isBefore(moment().startOf("day"))){var s=F(n.recurring,n.original);a={days:s.days,type:"Days Until",original:s.original}}else{var i=S(n.original);a={days:i.days,type:i.type,original:n.original}}O(n.event,a.days,a.type,a.original,n.recurring)}w(),x()})},x=function(){for(var e=document.getElementsByClassName("counter-edit"),t=document.getElementsByClassName("counter-delete"),n=0;n<e.length;n++)V(e[n]);for(var a=0;a<t.length;a++)R(t[a])},V=function(e){e.addEventListener("click",function(e){e.preventDefault(),n=this.parentNode,t=!0,C.setMoment(moment(n.dataset.original)),document.getElementById("modal-header-title").innerHTML="Edit Day Counter",document.getElementById("modal-submit").value="Save Day Counter",document.getElementById("event-name").value=n.getElementsByClassName("event-name")[0].innerHTML,document.getElementById("event-date").value=n.dataset.original,document.getElementById("event-recurring").value=n.dataset.recurring,r.classList.add("active")})},R=function(e){e.addEventListener("click",function(e){var t=this.parentNode;a=parseInt(t.id.split("-")[1]),f.classList.add("active")})},z=function(e){var t=document.getElementsByClassName("counter");if(void 0!==e.counterVisibility){for(var n=0;n<t.length;n++)t[n].classList.remove("disabled");if("future"===e.counterVisibility)for(var a=0;a<t.length;a++)-1!==t[a].getElementsByClassName("event-type")[0].innerHTML.indexOf("Since")&&t[a].classList.add("disabled");if("past"===e.counterVisibility)for(var s=0;s<t.length;s++)-1!==t[s].getElementsByClassName("event-type")[0].innerHTML.indexOf("Until")&&t[s].classList.add("disabled")}},P=function(e){var t=document.getElementsByClassName("counter");if(void 0!==e)for(var n=0;n<t.length;n++)t[n].classList.remove("disabled")},U=function(e){void 0!==e&&(document.removeEventListener("mousemove",A),i.classList.remove("faded"),clearTimeout(s),"disable"!==e&&(i.classList.add("faded"),document.addEventListener("mousemove",A)))},A=function(){s&&(clearTimeout(s),i.classList.remove("faded")),s=setTimeout(function(){i.classList.add("faded")},5e3)},$=function(){chrome.storage.sync.get("settings",function(e){void 0!==e.settings&&(I.value=e.settings.counterSize,h.value=e.settings.counterScheme,void 0!==e.settings.counterVisibility&&(Y.value=e.settings.counterVisibility),void 0!==e.settings.counterRange&&(M.value=e.settings.counterRange),void 0!==e.settings.fader&&(D.value=e.settings.fader),document.documentElement.className=h.value,i.className=I.value,window.setTimeout(function(){document.documentElement.style.transition="0.5s ease all",document.body.style.transition="0.5s ease all"},500),z(e.settings),P(e.settings.counterRange),U(e.settings.fader))})},q=function(){chrome.storage.sync.remove("settings",function(){chrome.storage.sync.set({settings:settingsObj},function(){console.log("Settings updated."),$()})})},F=function(e,t){var n;if("weekly"===e)for(n=moment(t).add(1,"week").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"week").format("YYYY-MM-D");else if("biweekly"===e)for(n=moment(t).add(2,"week").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(2,"week").format("YYYY-MM-D");else if("monthly"===e)for(n=moment(t).add(1,"month").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"month").format("YYYY-MM-D");else if("yearly"===e)for(n=moment(t).add(1,"year").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"year").format("YYYY-MM-D");return{days:S(n).days,original:n}},G=function(){j(),$(),d.addEventListener("click",function(e){e.preventDefault(),C.gotoDate(new Date),r.classList.add("active"),document.getElementById("modal-header-title").innerHTML="Add a New Day Counter",document.getElementById("modal-submit").value="Add Day Counter",document.body.classList.add("active")}),l.addEventListener("click",function(e){e.preventDefault(),r.classList.remove("active"),N(),T(),document.body.classList.remove("active")}),c.addEventListener("click",function(){var e=m.value,a=u.value,s=v.value,i=!1;if(""===e||null===e?(g.classList.add("active"),i=!0):g.classList.remove("active"),""!==a&&null!==a&&k(a)?y.classList.remove("active"):(y.classList.add("active"),i=!0),!i){var o=S(a);if(t)n.getElementsByClassName("event-name")[0].innerHTML=e,n.getElementsByClassName("event-days")[0].innerHTML=o.days,n.getElementsByClassName("event-type")[0].innerHTML=o.type,n.getElementsByClassName("event-date")[0].innerHTML=moment(a).format("ddd, ll"),n.dataset.original=a,n.dataset.recurring=s,n=null,t=!1;else{var d=O(e,o.days,o.type,a,s);V(d.getElementsByClassName("counter-edit")[0]),R(d.getElementsByClassName("counter-delete")[0])}r.classList.remove("active"),document.body.classList.remove("active"),N(),T(),w()}}),L.addEventListener("click",function(e){e.preventDefault(),document.getElementById("counter-"+a).remove(),w(),f.classList.remove("active")}),E.addEventListener("click",function(e){e.preventDefault(),a=null,f.classList.remove("active")}),B.addEventListener("click",function(){this.classList.contains("active")?(this.classList.remove("active"),p.classList.remove("active")):(this.classList.add("active"),p.classList.add("active"))}),b.addEventListener("click",function(e){e.preventDefault(),settingsObj={},settingsObj.counterSize=I.options[I.selectedIndex].value,settingsObj.counterScheme=h.options[h.selectedIndex].value,settingsObj.counterVisibility=Y.options[Y.selectedIndex].value,settingsObj.counterRange=M.options[M.selectedIndex].value,settingsObj.fader=D.options[D.selectedIndex].value,q()})};document.addEventListener("DOMContentLoaded",G)}();