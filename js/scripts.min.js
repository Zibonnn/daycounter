!function(){var e,t,n,a,s,i,o=document.getElementById("counters"),d=document.getElementById("no-counters"),r=document.getElementById("add-counter-btn"),l=document.getElementById("add-counter"),m=document.getElementById("close-modal"),c=document.getElementById("modal-submit"),u=document.getElementById("event-name"),v=document.getElementById("event-date"),f=document.getElementById("event-recurring"),g=document.getElementById("event-name-error"),y=document.getElementById("event-date-error"),E=document.getElementById("delete-counter"),L=document.getElementById("delete-cancel"),B=document.getElementById("delete-confirm"),p=document.getElementById("settings-toggle"),h=document.getElementById("settings"),I=document.getElementById("setting-size-list"),Y=document.getElementById("setting-scheme-list"),M=document.getElementById("setting-visible-list"),D=document.getElementById("setting-range-list"),b=document.getElementById("setting-fader-list"),C=document.getElementById("settings-save"),N=new Pikaday({field:document.getElementById("event-date"),format:"YYYY-MM-D"});Sortable.create(o,{animation:150,onEnd:function(){k()}});var T=function(){u.value="",v.value=""},w=function(){g.classList.remove("active"),y.classList.remove("active")},k=function(){var t=document.getElementsByClassName("counter");if(e={},t.length>0){for(var n=0;n<t.length;n++)t[n].id="counter-"+(n+1),e[n+1]={event:t[n].getElementsByClassName("event-name")[0].innerHTML,original:t[n].dataset.original,recurring:t[n].dataset.recurring};"active"===d.className&&(d.className="")}else d.className="active";x()},O=function(e,t,n,a,s){var i=document.createElement("li");i.dataset.recurring=s,i.dataset.original=a,i.classList.add("counter");var d=moment(a).format("ddd, ll");return i.innerHTML='<a class="counter-delete transition" href="#"><i class="fa fa-times" aria-hidden="true"></i></a><h3 class="event-name">'+e+'</h3><span class="event-days">'+t+'</span><p class="event-type">'+n+'</p><span class="event-date">'+d+'</span><a class="counter-edit transition" href="#">Edit Counter</a>',o.appendChild(i),i},S=function(e){if(!/^\d{4}\-\d{2}\-\d{1,2}$/.test(e))return!1;var t=e.split("-"),n=parseInt(t[0]),a=parseInt(t[1]),s=parseInt(t[2]);if(n<1e3||n>3e3||a<=0||a>12)return!1;var i=[31,28,31,30,31,30,31,31,30,31,30,31];return(n%400===0||n%100!==0&&n%4===0)&&(i[1]=29),s>0&&s<=i[a-1]},H=function(e){var t=864e5,n=new Date;n.setHours(0,0,0,0);var a=n.toISOString(),s=new Date(e).toISOString(),i=new Date(a),o=new Date(s),d={days:null,type:null};return o>i?(d.days=Math.round((o.getTime()-i.getTime())/t),d.type="Days Until"):(d.days=Math.round((i.getTime()-o.getTime())/t),d.type="Days Since"),0===d.days&&(d.days="Today",d.type="<br />"),d},x=function(){chrome.storage.sync.remove("counters",function(){chrome.storage.sync.set({counters:e},function(){console.log("Counters updated.")})})},V=function(){chrome.storage.sync.get("counters",function(e){for(var t in e.counters)if(e.counters.hasOwnProperty(t)){var n=e.counters[t],a={days:null,type:null,original:null};if(n.hasOwnProperty("recurring")||(n.recurring="none"),"none"!==n.recurring&&moment(n.original).isBefore(moment().startOf("day"))){var s=G(n.recurring,n.original);a={days:s.days,type:"Days Until",original:s.original}}else{var i=H(n.original);a={days:i.days,type:i.type,original:n.original}}O(n.event,a.days,a.type,a.original,n.recurring)}k(),R()})},R=function(){for(var e=document.getElementsByClassName("counter-edit"),t=document.getElementsByClassName("counter-delete"),n=0;n<e.length;n++)z(e[n]);for(var a=0;a<t.length;a++)P(t[a])},z=function(e){e.addEventListener("click",function(e){e.preventDefault(),n=this.parentNode,t=!0,N.setMoment(moment(n.dataset.original)),document.getElementById("modal-header-title").innerHTML="Edit Day Counter",document.getElementById("modal-submit").value="Save Day Counter",document.getElementById("event-name").value=n.getElementsByClassName("event-name")[0].innerHTML,document.getElementById("event-date").value=n.dataset.original,document.getElementById("event-recurring").value=n.dataset.recurring,l.classList.add("active")})},P=function(e){e.addEventListener("click",function(){var e=this.parentNode;a=parseInt(e.id.split("-")[1]),E.classList.add("active")})},U=function(e){var t=document.getElementsByClassName("counter");if("undefined"!=typeof e.counterVisibility){for(var n=0;n<t.length;n++)t[n].classList.remove("invisible");if("future"===e.counterVisibility)for(var a=0;a<t.length;a++)t[a].getElementsByClassName("event-type")[0].innerHTML.indexOf("Since")!==-1&&t[a].classList.add("invisible");if("past"===e.counterVisibility)for(var s=0;s<t.length;s++)t[s].getElementsByClassName("event-type")[0].innerHTML.indexOf("Until")!==-1&&t[s].classList.add("invisible")}},A=function(e){var t=document.getElementsByClassName("counter");if("undefined"!=typeof e){for(var n=0;n<t.length;n++)t[n].classList.remove("disabled");var a,s,i;if("week"===e)for(a=0;a<t.length;a++){s=t[a].dataset.original,i=moment(s);var o=moment().startOf("day").add(1,"week");i.isSameOrBefore(o)||t[a].classList.add("disabled")}else if("month"===e)for(a=0;a<t.length;a++){s=t[a].dataset.original,i=moment(s);var d=moment().startOf("day").add(1,"month");i.isSameOrBefore(d)||t[a].classList.add("disabled")}else if("quarter"===e)for(a=0;a<t.length;a++){s=t[a].dataset.original,i=moment(s);var r=moment().startOf("day").add(3,"months");i.isSameOrBefore(r)||t[a].classList.add("disabled")}else if("half"===e)for(a=0;a<t.length;a++){s=t[a].dataset.original,i=moment(s);var l=moment().startOf("day").add(6,"months");i.isSameOrBefore(l)||t[a].classList.add("disabled")}else if("year"===e)for(a=0;a<t.length;a++){s=t[a].dataset.original,i=moment(s);var m=moment().startOf("day").add(1,"year");i.isSameOrBefore(m)||t[a].classList.add("disabled")}}},q=function(e){"undefined"!=typeof e&&(document.removeEventListener("mousemove",$),o.classList.remove("faded"),clearTimeout(s),"disable"!==e&&(o.classList.add("faded"),document.addEventListener("mousemove",$)))},$=function(){s&&(clearTimeout(s),o.classList.remove("faded")),s=setTimeout(function(){o.classList.add("faded")},3e3)},j=function(){chrome.storage.sync.get("settings",function(e){"undefined"!=typeof e.settings&&(I.value=e.settings.counterSize,Y.value=e.settings.counterScheme,"undefined"!=typeof e.settings.counterVisibility&&(M.value=e.settings.counterVisibility),"undefined"!=typeof e.settings.counterRange&&(D.value=e.settings.counterRange),"undefined"!=typeof e.settings.fader&&(b.value=e.settings.fader),document.documentElement.className=Y.value,o.className=I.value,window.setTimeout(function(){document.documentElement.style.transition="0.5s ease all",document.body.style.transition="0.5s ease all"},500),U(e.settings),A(e.settings.counterRange),q(e.settings.fader))})},F=function(){chrome.storage.sync.remove("settings",function(){chrome.storage.sync.set({settings:i},function(){console.log("Settings updated."),j()})})},G=function(e,t){var n;if("weekly"===e)for(n=moment(t).add(1,"week").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"week").format("YYYY-MM-D");else if("biweekly"===e)for(n=moment(t).add(2,"week").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(2,"week").format("YYYY-MM-D");else if("monthly"===e)for(n=moment(t).add(1,"month").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"month").format("YYYY-MM-D");else if("yearly"===e)for(n=moment(t).add(1,"year").format("YYYY-MM-D");moment(n).isBefore(moment());)n=moment(n).add(1,"year").format("YYYY-MM-D");var a=H(n);return{days:a.days,original:n}},J=function(){V(),j(),r.addEventListener("click",function(e){e.preventDefault(),N.gotoDate(new Date),l.classList.add("active"),document.getElementById("modal-header-title").innerHTML="Add a New Day Counter",document.getElementById("modal-submit").value="Add Day Counter",document.body.classList.add("active")}),m.addEventListener("click",function(e){e.preventDefault(),l.classList.remove("active"),T(),w(),document.body.classList.remove("active")}),c.addEventListener("click",function(){var e=u.value,a=v.value,s=f.value,i=!1;if(""===e||null===e?(g.classList.add("active"),i=!0):g.classList.remove("active"),""!==a&&null!==a&&S(a)?y.classList.remove("active"):(y.classList.add("active"),i=!0),!i){var o=H(a);if(t)n.getElementsByClassName("event-name")[0].innerHTML=e,n.getElementsByClassName("event-days")[0].innerHTML=o.days,n.getElementsByClassName("event-type")[0].innerHTML=o.type,n.getElementsByClassName("event-date")[0].innerHTML=moment(a).format("ddd, ll"),n.dataset.original=a,n.dataset.recurring=s,n=null,t=!1;else{var d=O(e,o.days,o.type,a,s);z(d.getElementsByClassName("counter-edit")[0]),P(d.getElementsByClassName("counter-delete")[0])}l.classList.remove("active"),document.body.classList.remove("active"),T(),w(),k()}}),B.addEventListener("click",function(e){e.preventDefault(),document.getElementById("counter-"+a).remove(),k(),E.classList.remove("active")}),L.addEventListener("click",function(e){e.preventDefault(),a=null,E.classList.remove("active")}),p.addEventListener("click",function(){this.classList.contains("active")?(this.classList.remove("active"),h.classList.remove("active")):(this.classList.add("active"),h.classList.add("active"))}),C.addEventListener("click",function(e){e.preventDefault(),i={},i.counterSize=I.options[I.selectedIndex].value,i.counterScheme=Y.options[Y.selectedIndex].value,i.counterVisibility=M.options[M.selectedIndex].value,i.counterRange=D.options[D.selectedIndex].value,i.fader=b.options[b.selectedIndex].value,F(),p.classList.remove("active"),h.classList.remove("active")})};document.addEventListener("DOMContentLoaded",J)}();